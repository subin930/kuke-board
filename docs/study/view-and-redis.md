# 조회수 구현 설계와 Redis, 어뷰징 방지 
## 📍조회수 기능은 어떻게 구현하면 될까?
조회수 데이터의 특징을 살펴보면 다음과 같다.
<br>

1. **_데이터의 일관성이 비교적 중요하지 않다._** <br> 단순히 조회된 횟수만 보여주면 되기 때문에 드물게 불일치가 발생하더라도 사용자가 인지하기 어렵다.
2. **_쓰기 트래픽이 비교적 많다._** <br> 단순히 게시글 조회만 하더라도 조회수를 높이는 쓰기 작업이 필요하다.

<br><br>
MySQL을 사용한다면 디스크 접근 비용과 트랜잭션 관리 비용이 발생한다. 
따라서 **Redis**를 이용해 조회수 데이터를 관리해주는게 적합하다. <br><br><br>

## 📍Redis
### 🔒특징
1. 인메모리 데이터 베이스 → 고성능 
2. NoSQL(Not Only SQL) 데이터베이스 → 정해진 스키마 X
3. key-value 저장소
4. 다양한 자료 구조 지원 → String, List, Set, SortedSet, Hash 등
5. TTL(Time To Live) 지원
6. Single Thread로 동작 → 각 명령어가 단일 스레드에서 순차적으로 처리되므로 동시성 문제에 유용
7. 데이터 백업 지원 → AOF, RDB 등의 방법 이용
   * AOF(Append Only File): 수행된 명령어를 로그 파일에  기록 → 데이터 복구를 위해 로그를 재실행
   * RDB: snapshot 기능 → 저장된 데이터를 주기적으로 파일에 저장
8. Redis Cluster 기능 지원 → 확장성, 부하 분산, 고가용성 기능 제공(분산 시스템 구성 방법 제공)

<br><br><br>

### 🤔Redis를 어떤 용도로 사용 가능할까?
1. 고성능 작업: 인메모리 DB이므로 상대적으로 빠르기 때문에 Redis를 자체적으로 DB로 사용할 수 있다. 
2. 캐시
3. pub/sub

<br><br><br>

### ❕Redis Cluster
redis는 기본적으로 싱글 스레드로 동작하므로 redis cluster를 이용해 이를 수평 확장할 수 있다. 즉, Distributed DB로 활용할 수 있는 것이다. 이를 위해 redis는 **샤딩** 을 지원한다.
<br>
* Slot: 논리적 샤드 → slot = hash_function(key)
* Shard: 물리적 샤드 → shard = select_shard(slot)

<br><br>
뿐만 아니라 데이터 복제 기능도 제공한다.

<br><br><br>

## 📍어뷰징 방지 정책 설계
**어뷰징(Abusing)** 이란 오용, 남용의 뜻을 가진 abuse의 의미로, 검색을 통한 클릭 수를 늘리기 위해 동일한 제목의 기사나 문서를 제목이나 문장 순서만 변경하여 지속적으로 전송하는 것을 말한다.  

이번 구현에서는 다음 정책을 활용한다.

> **각 사용자는 게시글 1개 당 10분에 1번 조회수 증가**


<br>

**_조회 여부_** 는 다음과 같이 식별 가능하다.
1. 로그인 사용자: 사용자 별로 식별 가능
2. 비로그인 사용자: IP, User-Agent, 브라우저 쿠키, 토큰 등

<br><br> 

**_분산 락_** 을 활용할 수 있다.<br><br>
`게시글 id + 사용자 식별 코드`를 이용해 Redis에 TTL = 10 조건을 추가해 키를 추가한다. 만약 이미 키가 존재한다면, 10분 내에 접속한 기록이 존재한다는 것이고 이 경우에는 쓰기 요청이 실패한다. 이를 이용해 어뷰징을 처리하면 된다. 
<br>
** 분산 시스템에서 락을 거는 행위이므로 분산 락으로 볼 수 있다. 